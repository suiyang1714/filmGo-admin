{"version":3,"sources":["webpack:///webpack/bootstrap c7a8d7f033cba6b539f7","webpack:///external \"mongoose\"","webpack:///./~/babel-runtime/regenerator/index.js","webpack:///./server/database/schema/flim.js","webpack:///./server/database/schema/admin.js","webpack:///./server/database/schema/category.js","webpack:///./server/database/schema/comment.js","webpack:///./server/database/schema/genre.js","webpack:///./server/database/schema/user.js","webpack:///./nuxt.config.js","webpack:///./server/database/database.js","webpack:///./server/router/index.js","webpack:///external \"koa\"","webpack:///external \"koa-bodyparser\"","webpack:///external \"koa-session\"","webpack:///external \"koa2-cors\"","webpack:///external \"nuxt\"","webpack:///./server/config/index.js","webpack:///./server/database/schema ^\\.\\/.*$","webpack:///external \"axios\"","webpack:///external \"bcryptjs\"","webpack:///external \"fs\"","webpack:///external \"koa-router\"","webpack:///external \"path\"","webpack:///external \"regenerator-runtime\"","webpack:///./server/index.js"],"names":["mongoose","require","Schema","FilmSchema","title","String","pv","type","Number","default","comment","rating","Object","abstract","year","images","id","countries","Array","genres","name","source","ref","casts","original_title","summary","directors","meta","createdAt","updatedAt","Film","model","module","exports","bcrypt","SALT_WORK_FACTOR","MAX_LOGIN_ATTEMPTS","LOCK_TIME","AdminSchema","user","password","nickname","role","Date","now","pre","next","isNew","isModified","genSalt","err","salt","hash","error","methods","comparePassword","_password","Promise","resolve","reject","compare","isMatch","incLoginAttempts","that","lockUntil","update","$set","loginAttempts","$unset","updates","$inc","isLocked","Admin","CategorySchema","articleArray","Category","CommentSchema","articleId","from","reply","to","content","updateTime","Comment","GenreSchema","filmArray","Genre","UserSchema","openid","avatarUrl","unionid","province","country","city","gender","MinaUser","head","charset","hid","link","rel","href","css","loading","color","build","extend","config","ctx","isClient","rules","push","enforce","test","loader","exclude","fs","models","__dirname","readdirSync","filter","file","search","forEach","database","set","global","connect","db","connection","on","console","log","findOne","save","router","axios","doubanAPI","sleep","time","setTimeout","fetchFilms","get","films","i","data","subjects","film","filmObject","exec","filmData","all","map","item","index","fetchGenre","_id","genreId","length","genre","filmId","genreMsg","indexOf","find","body","success","app","host","process","env","HOST","port","PORT","dev","nuxt","builder","use","cors","origin","exposeHeaders","maxAge","credentials","allowMethods","allowHeaders","bodyParser","mongodb","keys","CONFIG","key","overwrite","httpOnly","signed","rolling","session","filmApi","routes","allowedMethods","status","req","res","render","promise","then","catch","listen","start"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 24);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap c7a8d7f033cba6b539f7","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"regenerator-runtime\");\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/regenerator/index.js\n// module id = 1\n// module chunks = 0","const mongoose = require('mongoose')\nconst { Schema } = mongoose\n\nconst FilmSchema = new Schema({\n  title: String,\n  pv: {\n    type: Number,\n    default: 1\n  },\n  comment: {\n    type: Number,\n    default: 0\n  },\n  rating: Object,\n  abstract: String,\n  year: String,\n  images: Object,\n  id: String,\n  countries: Array,\n  genres: [\n    {\n      name: String,\n      source: {\n        type: String,\n        ref: 'Tag'\n      }\n    }\n  ],\n  casts: Array,\n  original_title: String,\n  summary: String,\n  directors: Array,\n  meta: {\n    createdAt: {\n      type: String\n    },\n    updatedAt: {\n      type: String\n    }\n  }\n})\n\nconst Film = mongoose.model('Film', FilmSchema)\n\nmodule.exports = Film\n\n\n\n// WEBPACK FOOTER //\n// ./server/database/schema/flim.js","const mongoose = require('mongoose')\nconst bcrypt = require('bcryptjs')\n\nconst SALT_WORK_FACTOR = 10\nconst MAX_LOGIN_ATTEMPTS = 5\nconst LOCK_TIME = 2 * 60 * 60 * 1000\nconst Schema = mongoose.Schema\n\nconst AdminSchema = new Schema({\n  user: String,\n  password: String,\n  nickname: String,\n  role: {\n    type: String,\n    default: 'user'\n  },\n  meta: {\n    createdAt: {\n      type: Date,\n      default: Date.now()\n    },\n    updatedAt: {\n      type: Date,\n      default: Date.now()\n    }\n  }\n})\n\nAdminSchema.pre('save', function(next) {\n  if (this.isNew) {\n    this.meta.createdAt = this.meta.updatedAt = Date.now()\n  } else {\n    this.meta.updatedAt = Date.now()\n  }\n\n  next()\n})\n\nAdminSchema.pre('save', function(next) {\n  var user = this\n\n  if (!user.isModified('password')) return next()\n\n  bcrypt.genSalt(SALT_WORK_FACTOR, (err, salt) => {\n    if (err) return next(err)\n    bcrypt.hash(user.password, salt, (error, hash) => {\n      if (error) return next(error)\n\n      user.password = hash\n      next()\n    })\n  })\n})\n\nAdminSchema.methods = {\n  comparePassword: function (_password, password) {\n    return new Promise((resolve, reject) => {\n      bcrypt.compare(_password, password, function(err, isMatch) {\n        if (!err) resolve(isMatch)\n        else reject(err)\n      })\n    })\n  },\n\n  incLoginAttempts: function (user) {\n    var that = this\n\n    return new Promise((resolve, reject) => {\n      if (that.lockUntil && that.lockUntil < Date.now()) {\n        that.update({\n          $set: {\n            loginAttempts: 1\n          },\n          $unset: {\n            lockUntil: 1\n          }\n        }, function(err) {\n          if (!err) resolve(true)\n          else reject(err)\n        })\n      }\n      var updates = {\n        $inc: {\n          loginAttempts: 1\n        }\n      }\n      if (that.loginAttempts + 1 >= MAX_LOGIN_ATTEMPTS && !that.isLocked) {\n        updates.$set = {\n          lockUntil: Date.now() + LOCK_TIME\n        }\n      }\n\n      that.update(updates, err => {\n        if (!err) resolve(true)\n        else reject(err)\n      })\n    })\n  }\n}\n\nconst Admin = mongoose.model('Admin', AdminSchema)\n\nmodule.exports = Admin\n\n\n\n// WEBPACK FOOTER //\n// ./server/database/schema/admin.js","const mongoose = require('mongoose')\nconst { Schema } = mongoose\n\nconst CategorySchema = new Schema({\n  name: String,\n  articleArray: [\n    {\n      type: String,\n      ref: 'Article'\n    }\n  ],\n  meta: {\n    createdAt: {\n      type: Date,\n      default: Date.now()\n    },\n    updatedAt: {\n      type: Date,\n      default: Date.now()\n    }\n  }\n})\nCategorySchema.pre('save', function (next) {\n  if (this.isNew) {\n    this.meta.createdAt = this.meta.updatedAt = Date.now()\n  } else {\n    this.meta.updatedAt = Date.now()\n  }\n\n  next()\n})\n\nconst Category = mongoose.model('Category', CategorySchema)\n\nmodule.exports = Category\n\n\n\n// WEBPACK FOOTER //\n// ./server/database/schema/category.js","const mongoose = require('mongoose')\nconst { Schema } = mongoose\n\nconst CommentSchema = new Schema({\n  articleId: {\n    type: String,\n    ref: 'Article'\n  },\n  from: {\n    type: String,\n    ref: 'User'\n  },\n  reply: [{\n    from: {\n      type: String,\n      ref: 'User'\n    },\n    to: {\n      type: String,\n      ref: 'User'\n    },\n    content: String,\n    updateTime: String\n  }],\n  content: String,\n  meta: {\n    createdAt: {\n      type: Date,\n      default: Date.now()\n    },\n    updatedAt: {\n      type: Date,\n      default: Date.now()\n    }\n  }\n})\nCommentSchema.pre('save', function (next) {\n  if (this.isNew) {\n    this.meta.createdAt = this.meta.updatedAt = Date.now()\n  } else {\n    this.meta.updatedAt = Date.now()\n  }\n\n  next()\n})\n\nconst Comment = mongoose.model('Comment', CommentSchema)\n\nmodule.exports = Comment\n\n\n\n// WEBPACK FOOTER //\n// ./server/database/schema/comment.js","const mongoose = require('mongoose')\nconst { Schema } = mongoose\n\nconst GenreSchema = new Schema({\n  name: String,\n  filmArray: [\n    {\n      type: String,\n      ref: 'Article'\n    }\n  ],\n  meta: {\n    createdAt: {\n      type: Date,\n      default: Date.now()\n    },\n    updatedAt: {\n      type: Date,\n      default: Date.now()\n    }\n  }\n})\nGenreSchema.pre('save', function (next) {\n  if (this.isNew) {\n    this.meta.createdAt = this.meta.updatedAt = Date.now()\n  } else {\n    this.meta.updatedAt = Date.now()\n  }\n\n  next()\n})\n\nconst Genre = mongoose.model('Genre', GenreSchema)\n\nmodule.exports = Genre\n\n\n\n// WEBPACK FOOTER //\n// ./server/database/schema/genre.js","const mongoose = require('mongoose')\nconst Schema = mongoose.Schema\n\nconst UserSchema = new Schema({\n  openid: String,\n  avatarUrl: String,\n  nickname: String,\n  role: {\n    type: String,\n    default: 'user'\n  },\n  unionid: String,\n  province: String,\n  country: String,\n  city: String,\n  gender: String,\n  password: {\n    type: String\n  },\n  meta: {\n    createdAt: {\n      type: Date,\n      default: Date.now()\n    },\n    updatedAt: {\n      type: Date,\n      default: Date.now()\n    }\n  }\n})\n\nUserSchema.pre('save', function (next) {\n  if (this.isNew) {\n    this.meta.createdAt = this.meta.updatedAt = Date.now()\n  } else {\n    this.meta.updatedAt = Date.now()\n  }\n\n  next()\n})\n\nconst MinaUser = mongoose.model('MinaUser', UserSchema)\n\nmodule.exports = MinaUser\n\n\n\n// WEBPACK FOOTER //\n// ./server/database/schema/user.js","module.exports = {\n  /*\n  ** Headers of the page\n  */\n  head: {\n    title: 'starter',\n    meta: [\n      { charset: 'utf-8' },\n      { name: 'viewport', content: 'width=device-width, initial-scale=1' },\n      { hid: 'description', name: 'description', content: 'Nuxt.js project' }\n    ],\n    link: [\n      { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }\n    ]\n  },\n  /*\n  ** Global CSS\n  */\n  css: ['~assets/css/main.css'],\n  /*\n  ** Customize the progress-bar color\n  */\n  loading: { color: '#3B8070' },\n  /*\n   ** Build configuration\n   */\n  build: {\n    /*\n     ** Run ESLINT on save\n     */\n    extend (config, ctx) {\n      if (ctx.isClient) {\n        config.module.rules.push({\n          enforce: 'pre',\n          test: /\\.(js|vue)$/,\n          loader: 'eslint-loader',\n          exclude: /(node_modules)/\n        })\n      }\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js","var fs = require('fs')\nvar resolve = require('path').resolve\nvar mongoose = require('mongoose')\nvar config = require('../config')\n\n/*const models = resolve(__dirname, './schema')\nfs.readdirSync(models)\n  .filter(file => ~file.search(/^[^\\.].*js$/))\n  .forEach(file => require(resolve(models, file)))*/\nconst models = resolve(__dirname, '../database/schema')\nfs.readdirSync(models)\n  .filter(file => ~file.search(/^[^\\.].*js$/))\n  .forEach(file => {\n    require(`../database/schema/${file}`)\n    // require(resolve(models,file))\n  })\n\nconst database = () => {\n\n    mongoose.set('debug', true)\n\n    mongoose.Promise = global.Promise\n\n    mongoose.connect(config.db)\n\n    mongoose.connection.on('disconnected', () => {\n        mongoose.connect(config.db)\n    })\n    mongoose.connection.on('error', err => {\n        console.error(err)\n    })\n\n    mongoose.connection.on('open', async () => {\n\n      console.log('Connected to MongoDB ', config.db)\n\n      const Admin = mongoose.model('Admin')\n      let user = await Admin.findOne({\n        user: 'admin'\n      })\n\n      if (!user) {\n        console.log('写入管理员数据')\n\n        user = new Admin({\n          user: 'admin',\n          password: '123456',\n          role: 'superAdmin',\n          nickname: 'Aditya Sui'\n        })\n\n        await user.save()\n      }\n\n    })\n\n}\n\nmodule.exports = database\n\n\n\n// WEBPACK FOOTER //\n// ./server/database/database.js","const router = require('koa-router')()\nconst axios = require('axios')\nconst doubanAPI = 'http://api.douban.com/v2/movie/'\n\nconst sleep = async time => await new Promise( resolve => {\n  setTimeout( () => {\n    return resolve(console.log(`等待${time}s`))\n  }, time*1000)\n} )\nconst Film = require('../database/schema/flim')\nconst Genre = require('../database/schema/genre')\n\nconst fetchFilms = async () => {\n  let films = await axios.get(`${doubanAPI}coming_soon?count=100`)\n\n  for(let i = 0 ; i < films.data.subjects.length ; i++) {\n    const film = await axios.get(`${doubanAPI}subject/${films.data.subjects[i].id}`)\n    const filmObject = film.data\n    console.log(`第${i+1}个电影:\"${film.data.title}\"`)\n    let filmData = await Film\n      .findOne({id: film.data.id})\n      .exec()\n    if (!filmData) {\n      filmData = new Film({\n        title: film.data.title,\n        rating: film.data.rating,\n        year: film.data.year,\n        id: film.data.id,\n        summary: film.data.summary,\n        casts: film.data.casts,\n        original_title: film.data.original_title,\n        directors: film.data.directors,\n        images: film.data.images,\n        countries: film.data.countries\n      })\n      // 查询该标签：有 => 返回 tagId || 无 => 新建该标签，返回 tagId\n      await Promise.all(film.data.genres.map(async (item, index) => {\n        const genreId = await fetchGenre(item, filmData._id)\n        filmData.genres[index] = {\n          name: item,\n          source: genreId\n        }\n        return genreId\n      }))\n      filmData.save()\n      await sleep(2)\n    } else {\n      console.log('该电影已存在')\n    }\n  }\n}\n// 查询类型方法\nconst fetchGenre = (genre, filmId) => {\n  return new Promise(async resolve => {\n    let genreMsg = await Genre\n      .findOne({name: genre})\n      .exec()\n\n    if (!genreMsg) {\n      genreMsg = await new Genre({\n        name: genre\n      })\n\n      genreMsg.filmArray.push(filmId)\n      await genreMsg.save()\n      resolve(genreMsg._id)\n    } else {\n      if (genreMsg.filmArray.indexOf(filmId) === -1) {  // 检测该标签内是否含有该电影的 _id ,按道理说这一步是多余的，先保留看看。\n        genreMsg.filmArray.push(filmId)\n        await genreMsg.save()\n      }\n      resolve(genreMsg._id)\n    }\n  })\n}\nrouter.get('/api/film/comingsoon', async (ctx, next) => {\n  fetchFilms()\n\n  let films = await Film\n    .find()\n    .exec()\n  ctx.body = {\n    success: true,\n    data: films\n  }\n})\n\nmodule.exports = router\n\n\n\n// WEBPACK FOOTER //\n// ./server/router/index.js","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"koa-bodyparser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-bodyparser\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"koa-session\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-session\"\n// module id = 13\n// module chunks = 0","module.exports = require(\"koa2-cors\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa2-cors\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 15\n// module chunks = 0","const config = {\n  db:'mongodb://127.0.0.1/filmgo'\n}\n\nmodule.exports = config\n\n\n\n// WEBPACK FOOTER //\n// ./server/config/index.js","var map = {\n\t\"./admin\": 3,\n\t\"./admin.js\": 3,\n\t\"./category\": 4,\n\t\"./category.js\": 4,\n\t\"./comment\": 5,\n\t\"./comment.js\": 5,\n\t\"./flim\": 2,\n\t\"./flim.js\": 2,\n\t\"./genre\": 6,\n\t\"./genre.js\": 6,\n\t\"./user\": 7,\n\t\"./user.js\": 7\n};\nfunction webpackContext(req) {\n\treturn __webpack_require__(webpackContextResolve(req));\n};\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) // check for number\n\t\tthrow new Error(\"Cannot find module '\" + req + \"'.\");\n\treturn id;\n};\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 17;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./server/database/schema ^\\.\\/.*$\n// module id = 17\n// module chunks = 0","module.exports = require(\"axios\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"axios\"\n// module id = 18\n// module chunks = 0","module.exports = require(\"bcryptjs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bcryptjs\"\n// module id = 19\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 20\n// module chunks = 0","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 21\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 22\n// module chunks = 0","module.exports = require(\"regenerator-runtime\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"regenerator-runtime\"\n// module id = 23\n// module chunks = 0","import Koa from 'koa'\nimport { Nuxt, Builder } from 'nuxt'\n// after end\n\nimport session from 'koa-session'\n\nimport cors from 'koa2-cors'\n\nconst filmApi = require('./router')\nconst mongodb = require('./database/database')\nconst bodyParser = require('koa-bodyparser')\n\nasync function start () {\n  const app = new Koa()\n  const host = process.env.HOST || '127.0.0.1'\n  const port = process.env.PORT || 5000\n\n  // Import and Set Nuxt.js options\n  let config = require('../nuxt.config.js')\n  config.dev = !(app.env === 'production')\n\n  // Instantiate nuxt.js\n  const nuxt = new Nuxt(config)\n\n  // Build in development\n  if (config.dev) {\n    const builder = new Builder(nuxt)\n    await builder.build()\n  }\n  app.use(cors({\n    origin: function (ctx) {\n      return 'http://localhost:7998'\n    },\n    exposeHeaders: ['WWW-Authenticate', 'Server-Authorization'],\n    maxAge: 5,\n    credentials: true,\n    allowMethods: ['GET', 'POST', 'DELETE'],\n    allowHeaders: ['Content-Type', 'Authorization', 'Accept']\n  }))\n  // body-parser\n  app.use(bodyParser())\n\n  // mongodb\n  mongodb()\n\n  // session\n  app.keys = ['some session']\n\n  const CONFIG = {\n    key: 'SESSION', /** (string) cookie key (default is koa:sess) */\n    /** (number || 'session') maxAge in ms (default is 1 days) */\n    /** 'session' will result in a cookie that expires when session/browser is closed */\n    /** Warning: If a session cookie is stolen, this cookie will never expire */\n    maxAge: 86400000,\n    overwrite: true, /** (boolean) can overwrite or not (default true) */\n    httpOnly: true, /** (boolean) httpOnly or not (default true) */\n    signed: true, /** (boolean) signed or not (default true) */\n    rolling: false /** (boolean) Force a session identifier cookie to be set on every response. The expiration is reset to the original maxAge, resetting the expiration countdown. default is false **/\n  }\n  app.use(session(CONFIG, app))\n\n  // routes\n  app.use(filmApi.routes(), filmApi.allowedMethods())\n\n  app.use(async (ctx, next) => {\n    await next()\n    ctx.status = 200 // koa defaults to 404 when it sees that status is unset\n    ctx.req.session = ctx.session\n    return new Promise((resolve, reject) => {\n      ctx.res.on('close', resolve)\n      ctx.res.on('finish', resolve)\n      nuxt.render(ctx.req, ctx.res, promise => {\n        // nuxt.render passes a rejected promise into callback on error.\n        promise.then(resolve).catch(reject)\n      })\n    })\n  })\n\n  app.listen(port, host)\n  console.log('Server listening on ' + host + ':' + port) // eslint-disable-line no-console\n}\n\nstart()\n\n\n\n// WEBPACK FOOTER //\n// ./server/index.js"],"sourceRoot":""}